<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®šæ™‚ç‚¸å½ˆéŠæˆ² (è¨ˆæ¬¡ç‰ˆ)</title>
    <style>
        /* --- é é¢æ•´é«”æ¨£å¼ --- */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f8ff;
            color: #333;
            text-align: center;
            padding: 1em;
        }

        /* --- éŠæˆ²ä¸»å®¹å™¨ --- */
        .game-container {
            background-color: #ffffff;
            padding: 2em;
            border-radius: 15px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 600px;
            margin: 1em auto;
        }

        h1 { color: #d9534f; }
        h3, h4 { color: #5bc0de; }

        /* --- è¨ˆæ™‚å™¨é¡¯ç¤º --- */
        #timer-display {
            font-size: 5rem;
            font-weight: bold;
            color: #4CAF50;
            margin: 0.2em 0;
            letter-spacing: 5px;
            transition: color 0.5s;
        }

        @keyframes blinking-text {
            0% { opacity: 1; }
            50% { opacity: 0.3; }
            100% { opacity: 1; }
        }
        .blinking-text {
            color: #d9534f !important;
            animation: blinking-text 1s infinite;
        }

        /* --- æŒ‰éˆ•å’Œè¼¸å…¥æ¡†æ¨£å¼ --- */
        input[type="number"], input[type="text"], select, button {
            padding: 10px;
            font-size: 1em;
            border: 2px solid #ccc;
            border-radius: 8px;
            margin: 5px;
            vertical-align: middle;
        }
        button {
            background-color: #5bc0de;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
        }
        button:hover {
            background-color: #31b0d5;
            transform: scale(1.05);
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            transform: none;
        }
        #start-btn { background-color: #4CAF50; }
        #start-btn:hover:enabled { background-color: #45a049; }

        /* --- å€åŸŸåŠƒåˆ† --- */
        .area-section {
            margin: 1.5em 0;
            padding: 1em;
            border-top: 1px solid #eee;
        }
        .hidden { display: none; }

        /* --- ç‹€æ…‹è¨Šæ¯ --- */
        #status-message {
            font-size: 2em;
            font-weight: bold;
            color: #d9534f;
            min-height: 50px;
        }

        /* --- ç©å®¶åˆ—è¡¨æ¨£å¼ --- */
        #player-list {
            list-style-type: none;
            padding: 0;
            max-width: 400px;
            margin: 0 auto;
        }
        #player-list li {
            background-color: #f9f9f9;
            padding: 8px;
            margin-bottom: 5px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .remove-player-btn {
            background-color: #d9534f;
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            font-weight: bold;
            cursor: pointer;
            line-height: 25px;
            padding: 0;
        }
        
        /* --- æ­·å²ç´€éŒ„åˆ—è¡¨æ¨£å¼ --- */
        #history-list {
            list-style-type: decimal;
            padding-left: 30px;
            text-align: left;
            max-width: 300px;
            margin: 1em auto;
        }
        /* [æ–°åŠŸèƒ½ 2] ç‚ºæ¬¡æ•¸è¨ˆæ•¸å¢åŠ ç²—é«”å’Œé¡è‰² */
        #history-list .count {
            font-weight: bold;
            color: #d9534f;
            margin-left: 10px;
        }

        /* --- çµæŸå¾Œé¡¯ç¤ºçš„å…§å®¹æ¨£å¼ --- */
        #punishment-area {
            background-color: #fffbe6;
            border: 2px solid #f0ad4e;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            text-align: left;
            line-height: 1.8;
        }
        #punishment-area .player-name {
            font-weight: bold;
            font-size: 1.5em;
            color: #d9534f;
            display: block;
            text-align: center;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>

    <div class="game-container">
        <h1>ğŸ’£ å®šæ™‚ç‚¸å½ˆ (è¨ˆæ¬¡ç‰ˆ) ğŸ’£</h1>
        
        <div id="timer-display">01:00</div>
        <div id="status-message"></div>

        <div id="setup-area" class="area-section">
            <label for="time-input">éŠæˆ²æ™‚é–“ (ç§’):</label>
            <input type="number" id="time-input" value="60" min="5">
            <button id="start-btn">é–‹å§‹éŠæˆ²</button>
        </div>
        
        <div id="result-area" class="area-section hidden">
            <h3>æ˜¯èª°æ‹¿åˆ°äº†ç‚¸å½ˆï¼Ÿ</h3>
            <select id="player-select"></select>
            <button id="submit-name-btn">è¨˜éŒ„å§“å</button>
        </div>

        <div id="punishment-area" class="area-section hidden"></div>

        <div id="play-again-area" class="hidden">
             <button id="play-again-btn">å†ç©ä¸€è¼ªï¼</button>
        </div>
        
        <!-- [æ–°åŠŸèƒ½ 1] ç®¡ç†åå–®çš„è§¸ç™¼æŒ‰éˆ• -->
        <div class="area-section">
             <button id="toggle-players-btn">ç®¡ç†åå–®</button>
        </div>
        
        <!-- [æ–°åŠŸèƒ½ 1] ç©å®¶ç®¡ç†å€å¡Šé è¨­éš±è— -->
        <div id="player-management-area" class="area-section hidden">
            <h4>ğŸ® ç©å®¶ç®¡ç†</h4>
            <div>
                <input type="text" id="new-player-input" placeholder="è¼¸å…¥æ–°ç©å®¶å§“å">
                <button id="add-player-btn">æ–°å¢ç©å®¶</button>
            </div>
            <ul id="player-list"></ul>
        </div>

        <div id="history-area" class="area-section">
            <h4>ğŸ“œ è¢«ç‚¸åˆ°çš„æ¬¡æ•¸æ’è¡Œæ¦œ</h4>
            <ul id="history-list"></ul>
        </div>
    </div>

    <script>
        // --- å…ƒç´ æŠ“å– ---
        const timerDisplay = document.getElementById('timer-display');
        const statusMessage = document.getElementById('status-message');
        const timeInput = document.getElementById('time-input');
        const startBtn = document.getElementById('start-btn');
        const playerSelect = document.getElementById('player-select');
        const submitNameBtn = document.getElementById('submit-name-btn');
        const playAgainBtn = document.getElementById('play-again-btn');
        const newPlayerInput = document.getElementById('new-player-input');
        const addPlayerBtn = document.getElementById('add-player-btn');
        const playerList = document.getElementById('player-list');
        const historyList = document.getElementById('history-list');
        const setupArea = document.getElementById('setup-area');
        const resultArea = document.getElementById('result-area');
        const playAgainArea = document.getElementById('play-again-area');
        const punishmentArea = document.getElementById('punishment-area');
        // [æ–°åŠŸèƒ½ 1] æŠ“å–æ–°æŒ‰éˆ•å’Œç®¡ç†å€å¡Š
        const togglePlayersBtn = document.getElementById('toggle-players-btn');
        const playerManagementArea = document.getElementById('player-management-area');


        // --- éŠæˆ²è®Šæ•¸ ---
        let timer;
        let timeLeft = 0;
        let playerNames = [];
        // [æ–°åŠŸèƒ½ 2] æ­·å²ç´€éŒ„æ”¹ç‚ºç‰©ä»¶ä»¥å„²å­˜æ¬¡æ•¸
        let historyRecords = {}; // ä¾‹å¦‚: { 'å…æ©': 2, 'å¤ç¿°': 1 }
        const tickSound = new Audio('https://www.soundjay.com/clock/sounds/clock-ticking-1.mp3');
        tickSound.loop = true;
        const explosionSound = new Audio('https://www.soundjay.com/mechanical/sounds/explosion-01.mp3');

        // --- åŠŸèƒ½å‡½å¼ ---

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${String(minutes).padStart(2, '0')}:${String(remainingSeconds).padStart(2, '0')}`;
        }

        function startGame() {
            setupArea.classList.add('hidden');
            playAgainArea.classList.add('hidden');
            resultArea.classList.add('hidden');
            punishmentArea.classList.add('hidden');
            statusMessage.textContent = '';
            
            timeLeft = parseInt(timeInput.value, 10) || 60;
            
            timerDisplay.classList.remove('blinking-text');
            timerDisplay.textContent = formatTime(timeLeft);
            
            tickSound.play();

            timer = setInterval(() => {
                timeLeft--;
                timerDisplay.textContent = formatTime(timeLeft);

                if (timeLeft <= 10) {
                    timerDisplay.classList.add('blinking-text');
                }

                if (timeLeft <= 0) {
                    endGame();
                }
            }, 1000);
        }
        
        function endGame() {
            clearInterval(timer);
            tickSound.pause();
            tickSound.currentTime = 0;
            explosionSound.play();
            
            statusMessage.textContent = 'ğŸ’¥ è½Ÿéš†ï¼çˆ†ç‚¸äº†ï¼ ğŸ’¥';
            resultArea.classList.remove('hidden');
        }

        function showPunishment(playerName) {
            punishmentArea.innerHTML = `
                <span class="player-name">${playerName}ï¼Œè«‹å”¸å‡ºä¾†ï¼š</span>
                <p><strong>ä¸‰å­—è¨£ï¼š</strong>é †å¾ç¥ã€æœå¾äººã€‚</p>
                <p><strong>ä¸ƒå­—è¨£ï¼š</strong>ä¿¡è€Œé †å¾ç¥å–œæ„›ã€æœå¾æ¬ŠæŸ„ä¸é ‚æ’ã€‚</p>
                <p><strong>è®€è–ç¶“ç¯€ï¼š</strong>ã€Œåˆè¦è®“åŸºç£çš„å¹³å®‰åœ¨ä½ å€‘å¿ƒè£¡ä½œä»²è£ã€æ­Œç¾…è¥¿æ›¸3:15ä¸Š</p>
            `;
            punishmentArea.classList.remove('hidden');
        }

        function resetGame() {
            statusMessage.textContent = '';
            timeLeft = parseInt(timeInput.value, 10) || 60;
            timerDisplay.textContent = formatTime(timeLeft);
            timerDisplay.classList.remove('blinking-text');

            playAgainArea.classList.add('hidden');
            punishmentArea.classList.add('hidden');
            setupArea.classList.remove('hidden');
        }

        // --- ç©å®¶ç®¡ç† ---
        function renderPlayerList() {
            playerList.innerHTML = '';
            playerNames.forEach((name, index) => {
                const li = document.createElement('li');
                li.textContent = name;
                const removeBtn = document.createElement('button');
                removeBtn.textContent = 'X';
                removeBtn.className = 'remove-player-btn';
                removeBtn.onclick = () => removePlayer(index);
                li.appendChild(removeBtn);
                playerList.appendChild(li);
            });
            populatePlayerSelect();
            savePlayersToLocalStorage();
            updateStartButtonState();
        }

        function addPlayer() {
            const newName = newPlayerInput.value.trim();
            if (newName && !playerNames.includes(newName)) {
                playerNames.push(newName);
                newPlayerInput.value = '';
                renderPlayerList();
            } else if (playerNames.includes(newName)) {
                alert('é€™å€‹åå­—å·²ç¶“å­˜åœ¨äº†ï¼');
            }
        }

        function removePlayer(index) {
            const removedPlayer = playerNames[index];
            playerNames.splice(index, 1);
            // ç•¶å¾åå–®ç§»é™¤ç©å®¶æ™‚ï¼Œä¹Ÿå¾è¨ˆæ•¸æ­·å²ä¸­ç§»é™¤ï¼Œé¿å…è³‡æ–™ä¸ä¸€è‡´
            if (historyRecords[removedPlayer]) {
                delete historyRecords[removedPlayer];
                saveHistoryToLocalStorage();
                renderHistoryList();
            }
            renderPlayerList();
        }

        function populatePlayerSelect() {
            playerSelect.innerHTML = '';
            playerNames.forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                playerSelect.appendChild(option);
            });
        }
        
        function updateStartButtonState() {
            startBtn.disabled = playerNames.length === 0;
            if (startBtn.disabled) {
                statusMessage.textContent = 'è«‹å…ˆæ–°å¢ç©å®¶æ‰èƒ½é–‹å§‹éŠæˆ²ï¼';
            } else if (statusMessage.textContent === 'è«‹å…ˆæ–°å¢ç©å®¶æ‰èƒ½é–‹å§‹éŠæˆ²ï¼') {
                statusMessage.textContent = '';
            }
        }

        // --- æ­·å²ç´€éŒ„èˆ‡ LocalStorage ---
        
        // [æ–°åŠŸèƒ½ 2] æ›´æ–°æ¸²æŸ“æ­·å²ç´€éŒ„çš„å‡½å¼
        function renderHistoryList() {
            historyList.innerHTML = '';

            // å°‡ç‰©ä»¶è½‰æ›ç‚ºé™£åˆ—ä¸¦æ’åº
            const sortedRecords = Object.entries(historyRecords).sort(([, countA], [, countB]) => countB - countA);

            sortedRecords.forEach(([name, count]) => {
                const li = document.createElement('li');
                // ä½¿ç”¨ innerHTML ä»¥ä¾¿åŠ å…¥å¸¶æœ‰ class çš„ span
                li.innerHTML = `${name} <span class="count">${count} æ¬¡</span>`;
                historyList.appendChild(li);
            });
        }
        
        // [æ–°åŠŸèƒ½ 2] æ›´æ–°è¨˜éŒ„å§“åçš„å‡½å¼
        function recordNameAndShowPunishment() {
            const selectedPlayer = playerSelect.value;
            if (!selectedPlayer) {
                alert('è«‹é¸æ“‡ä¸€ä½ç©å®¶ï¼');
                return;
            }
            
            // å¦‚æœç©å®¶å·²åœ¨ç´€éŒ„ä¸­ï¼Œæ¬¡æ•¸+1ï¼Œå¦å‰‡è¨­ç‚º1
            historyRecords[selectedPlayer] = (historyRecords[selectedPlayer] || 0) + 1;
            
            saveHistoryToLocalStorage();
            renderHistoryList();
            
            resultArea.classList.add('hidden');
            showPunishment(selectedPlayer);
            playAgainArea.classList.remove('hidden');
        }

        function savePlayersToLocalStorage() {
            localStorage.setItem('bombGamePlayers', JSON.stringify(playerNames));
        }

        function saveHistoryToLocalStorage() {
            localStorage.setItem('bombGameHistory', JSON.stringify(historyRecords));
        }

        function loadFromLocalStorage() {
            const storedPlayers = localStorage.getItem('bombGamePlayers');
            const storedHistory = localStorage.getItem('bombGameHistory');
            
            if (storedPlayers) {
                playerNames = JSON.parse(storedPlayers);
            } else {
                playerNames = ['å…æ©', 'å…è–†', 'å¤ç¿°', 'ç­ ç¸¢', 'å¿ƒæ©', 'èŠŠå¦¤'];
            }
            
            if (storedHistory) {
                // [æ–°åŠŸèƒ½ 2] ç¢ºä¿è¼‰å…¥çš„æ˜¯ç‰©ä»¶
                historyRecords = JSON.parse(storedHistory) || {};
            }
        }

        // --- é é¢åˆå§‹åŒ– ---
        window.onload = () => {
            loadFromLocalStorage();
            renderPlayerList();
            renderHistoryList();
            
            const initialTime = parseInt(timeInput.value, 10);
            timerDisplay.textContent = formatTime(initialTime);

            // --- äº‹ä»¶ç¶å®š ---
            startBtn.addEventListener('click', startGame);
            submitNameBtn.addEventListener('click', recordNameAndShowPunishment);
            playAgainBtn.addEventListener('click', resetGame);
            addPlayerBtn.addEventListener('click', addPlayer);
            newPlayerInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addPlayer();
            });

            // [æ–°åŠŸèƒ½ 1] ç¶å®šç®¡ç†åå–®æŒ‰éˆ•çš„é»æ“Šäº‹ä»¶
            togglePlayersBtn.addEventListener('click', () => {
                playerManagementArea.classList.toggle('hidden');
                if (playerManagementArea.classList.contains('hidden')) {
                    togglePlayersBtn.textContent = 'ç®¡ç†åå–®';
                } else {
                    togglePlayersBtn.textContent = 'å®Œæˆç®¡ç†';
                }
            });
        };
    </script>
</body>
</html>
