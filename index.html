<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®šæ™‚ç‚¸å½ˆéŠæˆ² (é©šå–œç‰ˆ)</title>
    <style>
        /* --- é é¢æ•´é«”æ¨£å¼ --- */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f8ff;
            color: #333;
            padding: 1em;
        }

        /* --- ä¸»è¦ä½ˆå±€ï¼šFlexbox --- */
        .main-layout {
            display: flex;
            gap: 2em;
            max-width: 1000px;
            margin: 0 auto;
            align-items: flex-start;
        }

        .game-column {
            flex: 3; /* éŠæˆ²å€ä½”è¼ƒå¤§ç©ºé–“ */
            background-color: #ffffff;
            padding: 2em;
            border-radius: 15px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .sidebar-column {
            flex: 2; /* å´é‚Šæ¬„ä½”è¼ƒå°ç©ºé–“ */
            background-color: #f9f9f9;
            padding: 1.5em;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            position: sticky; /* è®“å´é‚Šæ¬„åœ¨æ»¾å‹•æ™‚å›ºå®š */
            top: 20px;
        }

        /* éŸ¿æ‡‰å¼è¨­è¨ˆï¼šåœ¨çª„è¢å¹•ä¸Šå°‡å´é‚Šæ¬„ç§»åˆ°ä¸Šæ–¹ */
        @media (max-width: 800px) {
            .main-layout {
                flex-direction: column;
            }
            .sidebar-column {
                width: 100%;
                box-sizing: border-box;
                position: static;
                order: -1; /* å°‡å´é‚Šæ¬„é¡¯ç¤ºåœ¨æœ€ä¸Šé¢ */
                margin-bottom: 2em;
            }
        }

        h1 { color: #d9534f; margin-top: 0; }
        h3, h4 { color: #5bc0de; }

        /* --- è¨ˆæ™‚å™¨é¡¯ç¤º --- */
        #timer-display {
            font-size: 5rem; font-weight: bold; color: #4CAF50; margin: 0.2em 0; letter-spacing: 5px; transition: color 0.5s, visibility 0.2s;
        }
        
        /* --- æŒ‰éˆ•å’Œè¼¸å…¥æ¡†æ¨£å¼ --- */
        input[type="number"], input[type="text"], select, button {
            padding: 10px; font-size: 1em; border: 2px solid #ccc; border-radius: 8px; margin: 5px; vertical-align: middle;
        }
        button { background-color: #5bc0de; color: white; border: none; cursor: pointer; transition: background-color 0.3s, transform 0.2s; }
        button:hover { background-color: #31b0d5; transform: scale(1.05); }
        button:disabled { background-color: #cccccc; cursor: not-allowed; transform: none; }
        #start-btn { background-color: #4CAF50; }
        #start-btn:hover:enabled { background-color: #45a049; }
        #stop-btn { background-color: #e74c3c; }
        #stop-btn:hover { background-color: #c0392b; }

        /* --- å€åŸŸåŠƒåˆ† --- */
        .area-section { margin: 1.5em 0; padding: 1em 0; border-top: 1px solid #eee; }
        .hidden { display: none; }

        /* --- ç‹€æ…‹è¨Šæ¯ --- */
        #status-message { font-size: 1.5em; font-weight: bold; color: #d9534f; min-height: 40px; }
        
        /* --- ç©å®¶åˆ—è¡¨æ¨£å¼ --- */
        #player-list { list-style-type: none; padding: 0; max-width: 400px; margin: 0 auto; }
        #player-list li { background-color: #f9f9f9; padding: 8px; margin-bottom: 5px; border-radius: 5px; display: flex; justify-content: space-between; align-items: center; }
        .remove-player-btn { background-color: #d9534f; color: white; border: none; border-radius: 50%; width: 25px; height: 25px; font-weight: bold; cursor: pointer; line-height: 25px; padding: 0; }
        
        /* --- æ­·å²ç´€éŒ„åˆ—è¡¨æ¨£å¼ --- */
        .history-header { display: flex; justify-content: space-between; align-items: center; }
        #history-list { list-style-type: decimal; padding-left: 20px; text-align: left; }
        #history-list .count { font-weight: bold; color: #d9534f; margin-left: 10px; }
        #clear-history-btn { background-color: #f44336; font-size: 0.8em; padding: 4px 8px; }

        /* --- çµæŸå¾Œé¡¯ç¤ºçš„å…§å®¹æ¨£å¼ --- */
        #punishment-area { background-color: #fffbe6; border: 2px solid #f0ad4e; border-radius: 10px; padding: 15px; margin-top: 20px; text-align: left; line-height: 1.8; }
        #punishment-area .player-name { font-weight: bold; font-size: 1.5em; color: #d9534f; display: block; text-align: center; margin-bottom: 10px; }

        /* --- é è…³æ§åˆ¶é … --- */
        .footer-controls { text-align: right; margin-top: 20px; }
        #show-players-btn { background: none; border: none; color: #888; font-size: 0.9em; text-decoration: underline; padding: 5px; cursor: pointer; }
        #show-players-btn:hover { color: #000; background: none; transform: none; }

        .management-header { display: flex; justify-content: space-between; align-items: center; }
    </style>
</head>
<body>
    <div class="main-layout">
        <div class="game-column">
            <h1>ğŸ’£ å®šæ™‚ç‚¸å½ˆ ğŸ’£</h1>
            
            <div id="timer-display">01:00</div>
            <div id="status-message"></div>

            <div id="setup-area" class="area-section">
                <label for="time-input">éŠæˆ²æ™‚é–“ (ç§’):</label>
                <input type="number" id="time-input" value="60" min="5">
                <button id="start-btn">é–‹å§‹éŠæˆ²</button>
            </div>
            
            <div id="stop-btn-area" class="hidden">
                <button id="stop-btn">ç«‹å³åœæ­¢</button>
            </div>
            
            <div id="result-area" class="area-section hidden">
                <h3>æ˜¯èª°æ‹¿åˆ°äº†ç‚¸å½ˆï¼Ÿ</h3>
                <select id="player-select"></select>
                <button id="submit-name-btn">è¨˜éŒ„å§“å</button>
            </div>

            <div id="punishment-area" class="area-section hidden"></div>

            <div id="play-again-area" class="hidden">
                 <button id="play-again-btn">å†ç©ä¸€è¼ªï¼</button>
            </div>
            
            <div id="player-management-area" class="area-section hidden">
                <div class="management-header">
                    <h4>ğŸ® ç©å®¶ç®¡ç†</h4>
                    <button id="hide-players-btn">å®Œæˆç®¡ç†</button>
                </div>
                <div>
                    <input type="text" id="new-player-input" placeholder="è¼¸å…¥æ–°ç©å®¶å§“å">
                    <button id="add-player-btn">æ–°å¢ç©å®¶</button>
                </div>
                <ul id="player-list"></ul>
            </div>

            <div class="footer-controls">
                 <button id="show-players-btn">ç®¡ç†åå–®</button>
            </div>
        </div>

        <div class="sidebar-column">
            <div class="history-header">
                <h4>ğŸ“œ æ¬¡æ•¸æ’è¡Œæ¦œ</h4>
                <button id="clear-history-btn" title="æ¸…é™¤æ‰€æœ‰ç´€éŒ„">æ¸…é™¤ç´€éŒ„</button>
            </div>
            <ul id="history-list"></ul>
        </div>
    </div>

    <script>
        // --- å…ƒç´ æŠ“å– ---
        const timerDisplay = document.getElementById('timer-display');
        const statusMessage = document.getElementById('status-message');
        const timeInput = document.getElementById('time-input');
        const startBtn = document.getElementById('start-btn');
        const playerSelect = document.getElementById('player-select');
        const submitNameBtn = document.getElementById('submit-name-btn');
        const playAgainBtn = document.getElementById('play-again-btn');
        const newPlayerInput = document.getElementById('new-player-input');
        const addPlayerBtn = document.getElementById('add-player-btn');
        const playerList = document.getElementById('player-list');
        const historyList = document.getElementById('history-list');
        const setupArea = document.getElementById('setup-area');
        const resultArea = document.getElementById('result-area');
        const playAgainArea = document.getElementById('play-again-area');
        const punishmentArea = document.getElementById('punishment-area');
        const playerManagementArea = document.getElementById('player-management-area');
        const clearHistoryBtn = document.getElementById('clear-history-btn');
        const stopBtnArea = document.getElementById('stop-btn-area');
        const stopBtn = document.getElementById('stop-btn');
        const showPlayersBtn = document.getElementById('show-players-btn');
        const hidePlayersBtn = document.getElementById('hide-players-btn');

        // --- éŠæˆ²è®Šæ•¸ ---
        let timer;
        let timeLeft = 0;
        let playerNames = [];
        let historyRecords = {}; 
        const tickSound = new Audio('https://www.soundjay.com/clock/sounds/clock-ticking-1.mp3');
        tickSound.loop = true;
        const explosionSound = new Audio('https://www.soundjay.com/mechanical/sounds/explosion-01.mp3');

        // --- åŠŸèƒ½å‡½å¼ ---
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            return `${String(minutes).padStart(2, '0')}:${String(seconds % 60).padStart(2, '0')}`;
        }

        function startGame() {
            setupArea.classList.add('hidden');
            stopBtnArea.classList.remove('hidden');
            playAgainArea.classList.add('hidden');
            resultArea.classList.add('hidden');
            punishmentArea.classList.add('hidden');
            statusMessage.textContent = '';
            
            // [æ–°åŠŸèƒ½] éš±è—è¨ˆæ™‚å™¨ï¼Œå¢åŠ åˆºæ¿€æ„Ÿ
            timerDisplay.style.visibility = 'hidden';
            
            timeLeft = parseInt(timeInput.value, 10) || 60;
            tickSound.play();

            timer = setInterval(() => {
                timeLeft--;
                if (timeLeft <= 0) endGame();
            }, 1000);
        }
        
        function endGame() {
            clearInterval(timer);
            tickSound.pause(); tickSound.currentTime = 0;
            explosionSound.play();
            statusMessage.textContent = 'ğŸ’¥ è½Ÿéš†ï¼çˆ†ç‚¸äº†ï¼ ğŸ’¥';
            resultArea.classList.remove('hidden');
            stopBtnArea.classList.add('hidden');
            
            // [æ–°åŠŸèƒ½] æ™‚é–“åˆ°ï¼Œé‡æ–°é¡¯ç¤ºè¨ˆæ™‚å™¨ (æœƒæ˜¯ 00:00)
            timerDisplay.textContent = formatTime(0);
            timerDisplay.style.visibility = 'visible';
            timerDisplay.style.color = '#d9534f'; // é¡¯ç¤ºç‚ºç´…è‰²
        }

        function showPunishment(playerName) {
            punishmentArea.innerHTML = `
                <span class="player-name">${playerName}ï¼Œè«‹å”¸å‡ºä¾†ï¼š</span>
                <p><strong>ä¸‰å­—è¨£ï¼š</strong>é †å¾ç¥ã€æœå¾äººã€‚</p>
                <p><strong>ä¸ƒå­—è¨£ï¼š</strong>ä¿¡è€Œé †å¾ç¥å–œæ„›ã€æœå¾æ¬ŠæŸ„ä¸é ‚æ’ã€‚</p>
                <p><strong>è®€è–ç¶“ç¯€ï¼š</strong>ã€Œåˆè¦è®“åŸºç£çš„å¹³å®‰åœ¨ä½ å€‘å¿ƒè£¡ä½œä»²è£ã€æ­Œç¾…è¥¿æ›¸3:15ä¸Š</p>
            `;
            punishmentArea.classList.remove('hidden');
        }

        function resetGame(message = '') {
            clearInterval(timer);
            tickSound.pause(); tickSound.currentTime = 0;
            statusMessage.textContent = message;
            timeLeft = parseInt(timeInput.value, 10) || 60;
            
            // [æ–°åŠŸèƒ½] é‡ç½®æ™‚ï¼Œç¢ºä¿è¨ˆæ™‚å™¨æ˜¯å¯è¦‹çš„
            timerDisplay.textContent = formatTime(timeLeft);
            timerDisplay.style.visibility = 'visible';
            timerDisplay.style.color = '#4CAF50'; // æ¢å¾©æ­£å¸¸é¡è‰²

            playAgainArea.classList.add('hidden');
            punishmentArea.classList.add('hidden');
            stopBtnArea.classList.add('hidden');
            setupArea.classList.remove('hidden');
            resultArea.classList.add('hidden');
        }

        // --- ç©å®¶ç®¡ç† ---
        function renderPlayerList() {
            playerList.innerHTML = '';
            playerNames.forEach((name, index) => {
                const li = document.createElement('li');
                li.textContent = name;
                const removeBtn = document.createElement('button');
                removeBtn.textContent = 'X';
                removeBtn.className = 'remove-player-btn';
                removeBtn.onclick = () => removePlayer(index);
                li.appendChild(removeBtn);
                playerList.appendChild(li);
            });
            populatePlayerSelect();
            savePlayersToLocalStorage();
            updateStartButtonState();
        }

        function addPlayer() {
            const newName = newPlayerInput.value.trim();
            if (newName && !playerNames.includes(newName)) {
                playerNames.push(newName);
                newPlayerInput.value = '';
                renderPlayerList();
            } else if (playerNames.includes(newName)) alert('é€™å€‹åå­—å·²ç¶“å­˜åœ¨äº†ï¼');
        }

        function removePlayer(index) {
            const removedPlayer = playerNames[index];
            playerNames.splice(index, 1);
            if (historyRecords[removedPlayer]) {
                delete historyRecords[removedPlayer];
                saveHistoryToLocalStorage();
                renderHistoryList();
            }
            renderPlayerList();
        }

        function populatePlayerSelect() {
            playerSelect.innerHTML = '';
            playerNames.forEach(name => {
                const option = document.createElement('option');
                option.value = name; option.textContent = name;
                playerSelect.appendChild(option);
            });
        }
        
        function updateStartButtonState() {
            startBtn.disabled = playerNames.length === 0;
            if (startBtn.disabled) {
                statusMessage.textContent = 'è«‹æ–°å¢ç©å®¶æ‰èƒ½é–‹å§‹éŠæˆ²ï¼';
            } else if (statusMessage.textContent === 'è«‹æ–°å¢ç©å®¶æ‰èƒ½é–‹å§‹éŠæˆ²ï¼') {
                statusMessage.textContent = '';
            }
        }

        // --- æ­·å²ç´€éŒ„èˆ‡ LocalStorage ---
        function renderHistoryList() {
            historyList.innerHTML = '';
            const sortedRecords = Object.entries(historyRecords).sort(([, countA], [, countB]) => countB - countA);
            sortedRecords.forEach(([name, count]) => {
                const li = document.createElement('li');
                li.innerHTML = `${name} <span class="count">${count} æ¬¡</span>`;
                historyList.appendChild(li);
            });
        }
        
        function recordNameAndShowPunishment() {
            const selectedPlayer = playerSelect.value;
            if (!selectedPlayer) { alert('è«‹é¸æ“‡ä¸€ä½ç©å®¶ï¼'); return; }
            historyRecords[selectedPlayer] = (historyRecords[selectedPlayer] || 0) + 1;
            saveHistoryToLocalStorage();
            renderHistoryList();
            resultArea.classList.add('hidden');
            showPunishment(selectedPlayer);
            playAgainArea.classList.remove('hidden');
        }

        function clearHistory() {
            if (confirm('æ‚¨ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰è¢«ç‚¸åˆ°çš„æ¬¡æ•¸ç´€éŒ„å—ï¼Ÿé€™å€‹å‹•ä½œç„¡æ³•å¾©åŸï¼')) {
                historyRecords = {};
                saveHistoryToLocalStorage();
                renderHistoryList();
                alert('æ‰€æœ‰ç´€éŒ„å·²æˆåŠŸæ¸…é™¤ï¼');
            }
        }

        function savePlayersToLocalStorage() { localStorage.setItem('bombGamePlayers', JSON.stringify(playerNames)); }
        function saveHistoryToLocalStorage() { localStorage.setItem('bombGameHistory', JSON.stringify(historyRecords)); }

        function loadFromLocalStorage() {
            const storedPlayers = localStorage.getItem('bombGamePlayers');
            playerNames = storedPlayers ? JSON.parse(storedPlayers) : ['å…æ©', 'å…è–†', 'å¤ç¿°', 'ç­ ç¸¢', 'å¿ƒæ©', 'èŠŠå¦¤'];
            const storedHistory = localStorage.getItem('bombGameHistory');
            historyRecords = storedHistory ? JSON.parse(storedHistory) : {};
        }

        // --- é é¢åˆå§‹åŒ–èˆ‡äº‹ä»¶ç¶å®š ---
        window.onload = () => {
            loadFromLocalStorage();
            renderPlayerList();
            renderHistoryList();
            resetGame();

            startBtn.addEventListener('click', startGame);
            submitNameBtn.addEventListener('click', recordNameAndShowPunishment);
            playAgainBtn.addEventListener('click', () => resetGame());
            addPlayerBtn.addEventListener('click', addPlayer);
            newPlayerInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') addPlayer(); });
            clearHistoryBtn.addEventListener('click', clearHistory);
            stopBtn.addEventListener('click', () => resetGame('éŠæˆ²å·²æ‰‹å‹•åœæ­¢ã€‚'));
            showPlayersBtn.addEventListener('click', () => playerManagementArea.classList.remove('hidden'));
            hidePlayersBtn.addEventListener('click', () => playerManagementArea.classList.add('hidden'));
        };
    </script>
</body>
</html>
